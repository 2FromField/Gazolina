airflow:
  executor: LocalExecutor
  loadExamples: false

  data:
    metadataConnection:
      user: airflow
      pass: airflow
      protocol: postgresql
      host: postgresql.database.svc.cluster.local
      port: 5432
      db: airflow

  secrets:
    - envName: AIRFLOW__CORE__FERNET_KEY
      secretName: airflow-fernet-key
      secretKey: airflow-fernet-key
    - envName: AIRFLOW__WEBSERVER__SECRET_KEY
      secretName: airflow-webserver-secret-key
      secretKey: webserver-secret-key

  webserver:
    extraEnv:
      - name: AIRFLOW__WEBSERVER__SECRET_KEY
        valueFrom:
          secretKeyRef:
            name: airflow-webserver-secret-key
            key: webserver-secret-key
    defaultUser:
      enabled: true
      username: admin
      password: "change-me"
      role: Admin
      email: admin@example.com
      firstName: Admin
      lastName: User
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
    service:
      type: NodePort
      ports:
        - name: http
          port: 8080
          targetPort: 8080
          nodePort: 30080

  dags:
    persistence:
      enabled: false
    gitSync:
      enabled: true
      repo: "https://github.com/2FromField/Gazolina.git"
      branch: "main"
      subPath: "uv_gazolina"
      wait: 150
      depth: 1

  scheduler:
    extraEnv:
      - name: AIRFLOW__WEBSERVER__SECRET_KEY
        valueFrom:
          secretKeyRef:
            name: airflow-webserver-secret-key
            key: webserver-secret-key
    resources:
      requests:
        cpu: 100m
        memory: 256Mi

  triggerer:
    enabled: false
    # resources:
    #   requests:
    #     cpu: 50m
    #     memory: 128Mi

  migrateDatabaseJob:
    enabled: true

  rbac:
    create: true

  serviceAccount:
    create: true
    automountServiceAccountToken: true

  # Désactive le PostgreSQL embarqué (on utilise ton instance externe)
  postgresql:
    enabled: false
